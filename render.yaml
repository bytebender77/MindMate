services:
  # Backend API Service
  - type: web
    name: mindmate-api
    env: python
    plan: starter  # Free tier, upgrade as needed
    region: oregon  # Choose your preferred region
    buildCommand: pip install -r backend/requirements.txt
    startCommand: cd backend && gunicorn app.main:app --workers 2 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 120
    healthCheckPath: /health
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.0
      - key: PORT
        value: 8000
      - key: HOST
        value: 0.0.0.0
      - key: DEBUG
        value: "False"
      - key: REFLECTION_PROVIDER
        value: gemini  # or openai
      - key: GEMINI_MODEL
        value: gemini-2.5-flash
      - key: OPENAI_MODEL
        value: gpt-4o-mini
      - key: WHISPER_MODEL
        value: whisper-1
      # Add these in Render Dashboard as Secret Files:
      # - OPENAI_API_KEY
      # - GEMINI_API_KEY
      # - DATABASE_URL (auto-provided if using Render PostgreSQL)
      # - CORS_ORIGINS (e.g., "https://your-frontend.onrender.com")

  # PostgreSQL Database (Optional - can use external database)
  - type: pspg
    name: mindmate-db
    plan: starter  # Free tier
    databaseName: mindmate
    databaseUser: mindmate_user
    # DATABASE_URL is automatically provided as environment variable

  # Frontend Static Site
  - type: web
    name: mindmate-frontend
    env: static
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: ./frontend/dist
    pullRequestPreviewsEnabled: false
    envVars:
      - key: VITE_API_URL
        value: https://mindmate-api.onrender.com  # Update with your backend URL after deployment
      - key: NODE_VERSION
        value: 20.17.0

