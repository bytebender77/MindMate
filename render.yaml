services:
  # Backend API Service (Free Tier)
  # IMPORTANT: If Blueprint requires payment, deploy manually instead (see RENDER_MANUAL_DEPLOY.md)
  # Note: Free tier services spin down after 15 minutes of inactivity
  # First request after spin-down may take 30-60 seconds to respond
  - type: web
    name: mindmate-api
    env: python
    # Free tier - no plan specified (512MB RAM, 0.1 CPU)
    rootDir: backend  # Set root directory to backend folder
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app.main:app --workers 1 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 120
    healthCheckPath: /health
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.0
      - key: DEBUG
        value: "False"
      - key: REFLECTION_PROVIDER
        value: gemini
      - key: GEMINI_MODEL
        value: gemini-2.5-flash
      - key: OPENAI_MODEL
        value: gpt-4o-mini
      - key: WHISPER_MODEL
        value: whisper-1
      # IMPORTANT: Add these as Secret environment variables in Render Dashboard:
      # - OPENAI_API_KEY (Secret) - Required if using OpenAI
      # - GEMINI_API_KEY (Secret) - Required if using Gemini
      # - CORS_ORIGINS - Set after frontend deployment (e.g., "https://mindmate-frontend.onrender.com")
      # - USE_LIGHT_MODEL=true - Recommended for free tier (uses lighter model to save memory)
      # 
      # DATABASE SETUP (Free Tier):
      # Option 1: Use SQLite (Recommended for Free Tier)
      #   - App will use SQLite if DATABASE_URL is not set
      #   - No additional setup required
      #   - Data persists in the service's file system
      #   - Note: Data is lost if service is deleted
      # Option 2: Create free PostgreSQL database (30 days free)
      #   1. Go to Dashboard → New → PostgreSQL
      #   2. Select Free tier (expires after 30 days)
      #   3. Link it to this web service
      #   4. DATABASE_URL will be automatically provided
      #   - Note: Free PostgreSQL expires after 30 days

  # Frontend Static Site
  - type: web
    name: mindmate-frontend
    env: static
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: frontend/dist
    pullRequestPreviewsEnabled: false
    envVars:
      - key: VITE_API_URL
        value: https://mindmate-api.onrender.com
        # IMPORTANT: Update this URL after backend deployment to match your actual backend URL
      - key: NODE_VERSION
        value: 20.17.0

